{% extends "base.html" %}

{% block title %}IT Support Request Portal{% endblock %}

{% block content %}
<div class="container">
    {% if auth_disabled %}
    <!-- Authentication Disabled Notice -->
    <div class="alert alert-warning alert-dismissible fade show mb-4" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        <strong>Development Mode:</strong> Authentication is currently disabled. You are logged in as a development user.
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}
    
    <!-- Welcome Header -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="text-center">
                <h1 class="display-5 fw-bold text-primary mb-3">
                    Support Request Portal
                </h1>
                <p class="lead text-muted">
                    Welcome, {{ user.name }}! Select the type of request you need help with.
                </p>
            </div>
        </div>
    </div>

        <!-- Quick Info Section -->
    <!-- <div class="row mt-5 mb-5">
        <div class="col-12">
            <div class="card bg-light">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 text-center mb-3 mb-md-0">
                            <i class="bi bi-clock text-primary" style="font-size: 2rem;"></i>
                            <h6 class="mt-2 mb-1">Quick Response</h6>
                            <small class="text-muted">Most requests are processed within 24 hours</small>
                        </div>
                        <div class="col-md-4 text-center mb-3 mb-md-0">
                            <i class="bi bi-shield-check text-success" style="font-size: 2rem;"></i>
                            <h6 class="mt-2 mb-1">Secure & Private</h6>
                            <small class="text-muted">All submissions are encrypted and logged</small>
                        </div>
                        <div class="col-md-4 text-center">
                            <i class="bi bi-people text-info" style="font-size: 2rem;"></i>
                            <h6 class="mt-2 mb-1">Expert Support</h6>
                            <small class="text-muted">Our IT team is here to help you succeed</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div> -->

    <!-- Request Type Cards -->
    <div class="row g-4">
        {% for type, info in request_types %}
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 request-type-card" data-type="{{ type }}">
                <div class="card-body d-flex flex-column">
                    <div class="text-center mb-3">
                        <i class="{{ info.icon|default('bi-info-circle') }} text-{{ info.color|default('primary') }}" style="font-size: 3rem;"></i>
                    </div>
                    
                    <h5 class="card-title text-center mb-3">{{ info.label }}</h5>
                    
                    <p class="card-text text-muted flex-grow-1">
                        {{ info.description }}
                    </p>
                    
                    <div class="mt-auto">
                        <a href="/form/{{ type }}" class="btn btn-outline-primary w-100">
                            <i class="bi bi-arrow-right me-2"></i>
                            Start Request
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- My Tickets Section -->
    {% if user_tickets %}
    <div class="row mt-5">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4 class="mb-0">
                    <i class="bi bi-ticket-perforated me-2"></i>
                    My Tickets
                </h4>
            </div>
            
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Ticket #</th>
                                    <th>Subject</th>
                                    <th>Status</th>
                                    <th>Last Updated</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for ticket in user_tickets|slice(0, 10) %}
                                <tr>
                                    <td><strong>#{{ ticket.number }}</strong></td>
                                    <td>{{ ticket.subject }}</td>
                                    <td>
                                        {% if ticket.status == 'active' %}
                                            <span class="badge bg-success">Active</span>
                                        {% elseif ticket.status == 'pending' %}
                                            <span class="badge bg-warning">Pending</span>
                                        {% elseif ticket.status == 'closed' %}
                                            <span class="badge bg-secondary">Closed</span>
                                        {% else %}
                                            <span class="badge bg-info">{{ ticket.status|title }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <small class="text-muted">{{ ticket.updatedAt|date('M d, Y g:i A') }}</small>
                                    </td>
                                    <td>
                                        <a href="/ticket/{{ ticket.id }}" class="btn btn-sm btn-outline-primary">
                                            <i class="bi bi-eye me-1"></i> View
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% if user_tickets|length > 10 %}
                    <div class="text-center mt-3">
                        <small class="text-muted">Showing 10 most recent tickets</small>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}
        
    <!-- Helpful Information -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">
                    <i class="bi bi-activity me-2"></i>
                    Helpful Information
                </h5>
            </div>
            
            <div class="row g-3">
                <div class="col-md-6">
                    <a href="mailto:{{ branding.it_contact_email }}" class="text-decoration-none">
                        <div class="card border-0 bg-primary bg-opacity-10 h-100" style="cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
                            <div class="card-body">
                                <h6 class="card-title text-dark">
                                    <i class="bi bi-lightning text-primary me-2"></i>
                                    Emergency Support
                                    <i class="bi bi-envelope text-primary ms-1" style="font-size: 0.8rem;"></i>
                                </h6>
                                <p class="card-text small text-muted mb-0">
                                    For critical issues affecting production systems, email {{ branding.it_contact_email }} immediately
                                </p>
                            </div>
                        </div>
                    </a>
                </div>
                
                <div class="col-md-6">
                    {% if branding.self_service_url %}
                    <a href="{{ branding.self_service_url }}" target="_blank" class="text-decoration-none" rel="noopener noreferrer">
                        <div class="card border-0 bg-info bg-opacity-10 h-100" style="cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-3px)'" onmouseout="this.style.transform='translateY(0)'">
                            <div class="card-body">
                                <h6 class="card-title text-dark">
                                    <i class="bi bi-book text-info me-2"></i>
                                    Self-Service Resources
                                    <i class="bi bi-box-arrow-up-right text-info ms-1" style="font-size: 0.8rem;"></i>
                                </h6>
                                <p class="card-text small text-muted mb-0">
                                    Check our knowledge base for common solutions and troubleshooting guides
                                </p>
                            </div>
                        </div>
                    </a>
                    {% else %}
                    <div class="card border-0 bg-info bg-opacity-10">
                        <div class="card-body">
                            <h6 class="card-title">
                                <i class="bi bi-book text-info me-2"></i>
                                Self-Service Resources
                            </h6>
                            <p class="card-text small text-muted mb-0">
                                Check our knowledge base for common solutions and troubleshooting guides
                            </p>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Add hover effects to request type cards
document.querySelectorAll('.request-type-card').forEach(card => {
    card.addEventListener('mouseenter', function() {
        this.style.transform = 'translateY(-5px)';
        this.style.transition = 'transform 0.3s ease';
    });
    
    card.addEventListener('mouseleave', function() {
        this.style.transform = 'translateY(0)';
    });
    
    // Make entire card clickable
    card.addEventListener('click', function() {
        const type = this.dataset.type;
        window.location.href = `/form/${type}`;
    });
});
</script>
{% endblock %}
